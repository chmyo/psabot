const getRawBody = require('raw-body')
const typer = require('media-typer')

module.exports = function parse (req, {limit = '1mb'} = {}) {return __async(function*(){
  const type = req.headers['content-type']
  const encoding = typer.parse(type).parameters.charset
  req.rawBody = req.rawBody || getRawBody(req, {limit, encoding})
  const str = yield req.rawBody

  return str.toString()
}())}

function __async(g){return new Promise(function(s,j){function c(a,x){try{var r=g[x?"throw":"next"](a)}catch(e){j(e);return}r.done?s(r.value):Promise.resolve(r.value).then(c,d)}function d(e){c(e,1)}c()})}
